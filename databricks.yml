# Databricks Asset Bundle Configuration
bundle:
  name: mouna

workspace:
  host: https://adb-7405612889063784.4.azuredatabricks.net

targets:
  dev:
    mode: development
    workspace:
      root_path: /Users/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}

resources:
  jobs:
    # Full pipeline â€” serverless compute, 5 sample videos
    mouna_pipeline:
      name: "[${bundle.target}] Mouna - Full Pipeline"

      environments:
        - environment_key: silver_env
          spec:
            client: "1"
            dependencies:
              - mediapipe
              - loguru
              - tqdm

        - environment_key: train_env
          spec:
            client: "1"
            dependencies:
              - torch
              - mlflow
              - pydantic-settings
              - pyyaml

      tasks:
        - task_key: download_videos
          notebook_task:
            notebook_path: ./notebooks/databricks/02_bronze_ingest.py
            base_parameters:
              sample_size: "5"

        - task_key: extract_keypoints
          depends_on:
            - task_key: download_videos
          environment_key: silver_env
          notebook_task:
            notebook_path: ./notebooks/databricks/03_silver_preprocessing.py

        - task_key: train_model
          depends_on:
            - task_key: extract_keypoints
          environment_key: train_env
          notebook_task:
            notebook_path: ./notebooks/databricks/04_train_baseline.py
